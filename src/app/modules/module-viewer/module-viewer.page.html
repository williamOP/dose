<ion-header no-border>
  <ion-toolbar #titleToolbar class='title-toolbar' (swipe)=handleTitleSwipe($event)>
    <!-- back button -->
    <ion-buttons [class.hidden]='searchActive' slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <!-- title -->
    <ion-title #title [class.hidden]='searchActive || loadedModule.searchbarText != ""' (click)='toggleExpandTitle()'>
      <span [class.expand-title]='expandTitle'>{{ moduleActive ? loadedModule.metadata.title : "Module Viewer" }}</span>
    </ion-title>
    <ion-buttons [class.hidden]='searchActive' slot="end">
      <!-- search button -->
      <ion-button *ngIf='loadedModule.searchbarPlaceholder != ""' [class.hidden]='loadedModule.searchbarText !== ""'
        (click)="openSearchBar()">
        <ion-icon slot="icon-only" name="search"></ion-icon>
      </ion-button>
      <!-- filter button -->
      <ion-button *ngIf='(loadedModule.sortByList && loadedModule.sortByList.length > 1) || 
                          (loadedModule.filters && loadedModule.filters.length > 0)' (click)="presentFilter($event)">
        <ion-icon slot="icon-only" name="options"></ion-icon>
      </ion-button>
    </ion-buttons>
    <!-- Search bar -->
    <ion-searchbar [(ngModel)]="loadedModule.searchbarText"
      [class.hidden]='!searchActive && loadedModule.searchbarText === ""' (ionBlur)='searchActive = false'
      (ionFocus)='searchActive = true' (ionChange)='loadedModule.updateFilter()' debounce='50'
      [placeholder]='loadedModule.searchbarPlaceholder' animated=true></ion-searchbar>
  </ion-toolbar>
  <!-- Tabs -->
  <ion-segment [(ngModel)]='this.activeView' mode='md'>
    <ion-segment-button value="primary" mode='md'>
      Calculator
    </ion-segment-button>
    <ion-segment-button value="information" mode='md'>
      Information
    </ion-segment-button>
  </ion-segment>
</ion-header>

<ion-content class='module-viewer'>
  <!-- Primary container is the module, hidden if not selected -->
  <div [class.hidden]="activeView !== 'primary'">
    <ion-router-outlet (activate)="onActivate($event)"></ion-router-outlet>
  </div>

  <!-- Information container, hidden if not selected -->
  <div *ngIf="moduleActive && activeView === 'information'">
    <ion-col>
      <!-- About -->
      <ion-card *ngIf="loadedModule.metadata.longDescription" id="about-card">
        <ion-card-header color='fruit-blue-grey'>
          <ion-card-title>
            About
          </ion-card-title>
        </ion-card-header>
        <ion-card-content [innerHTML]="loadedModule.metadata.longDescription">
        </ion-card-content>
      </ion-card>
      <!-- References -->
      <ion-card *ngIf="loadedModule.metadata.references" id="references-card">
        <ion-card-header color='fruit-blue-grey'>
          <ion-card-title>
            References
          </ion-card-title>
        </ion-card-header>
        <ion-item *ngFor="let reference of loadedModule.metadata.references" button lines="full"
          (click)="openLink(reference.link)">
          <ion-label>
            <h2>{{ reference.description }}</h2>
            <p>{{ reference.referenceName }}</p>
          </ion-label>
        </ion-item>
        <p></p>
      </ion-card>
    </ion-col>
  </div>
</ion-content>

<app-result-footer [resultTitle]='loadedModule.displayedResult'
[resultDescription]='loadedModule.displayedResultDescription'>
</app-result-footer>